<!doctype html>
<html prefix="og:http://ogp.me/ns#" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml" >
<html>

<head>
    <meta charset="utf-8">
    
    <meta property="og:title" content="Facebook API test" >
    <meta property="og:type" content="website" >
    <meta property="og:url" content="https://github.com/booda406/wp2014s_hw4" >
    <meta property="og:image" content="https://www.facebook.com/Bnlsteven/profile_picture" >

    <title>HTML5 Canvas & facebook</title>
    <meta name="description" content=" ">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="css/style.css">

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

	<style>
    #canvas {border: 3px solid grey;}
    </style>
    <script>
        /**
         * This is the getPhoto library
         */

        function makeFacebookPhotoURL( id, accessToken ) {
            return 'https://graph.facebook.com/' + id + '/picture?access_token=' + accessToken;
        }

        function login( callback ) {
            FB.login(function(response) {
                if (response.authResponse) {
                    //console.log('Welcome!  Fetching your information.... ');
                    if (callback) {
                        callback(response);
                    }
                } else {
                    console.log('User cancelled login or did not fully authorize.');
                }
            },{scope: 'user_photos'} );
        }

        function getAlbums( callback ) {
            FB.api(
                    '/me/albums',
                    {fields: 'id,cover_photo'},
                    function(albumResponse) {
                        //console.log( ' got albums ' );
                        if (callback) {
                            callback(albumResponse);
                        }
                    }
                );

        }

        function getPhotosForAlbumId( albumId, callback ) {
            FB.api(
                    '/'+albumId+'/photos',
                    {fields: 'id'},
                    function(albumPhotosResponse) {
                        //console.log( ' got photos for album ' + albumId );
                        if (callback) {
                            callback( albumId, albumPhotosResponse );
                        }
                    }
                );
        }

        function getLikesForPhotoId( photoId, callback ) {
            FB.api(
                    '/'+albumId+'/photos/'+photoId+'/likes',
                    {},
                    function(photoLikesResponse) {
                        if (callback) {
                            callback( photoId, photoLikesResponse );
                        }
                    }
                );
        }

        function getPhotos(callback) {

            var allPhotos = [];

            var accessToken = '';

            login(function(loginResponse) {
                    accessToken = loginResponse.authResponse.accessToken || '';
                    getAlbums(function(albumResponse) {
                            var i, album, deferreds = {}, listOfDeferreds = [];

                            for (i = 0; i < albumResponse.data.length; i++) {
                                album = albumResponse.data[i];
                                deferreds[album.id] = $.Deferred();
                                listOfDeferreds.push( deferreds[album.id] );
                                getPhotosForAlbumId( album.id, function( albumId, albumPhotosResponse ) {
                                        var i, facebookPhoto;
                                        for (i = 0; i < albumPhotosResponse.data.length; i++) {
                                            facebookPhoto = albumPhotosResponse.data[i];
                                            allPhotos.push({
                                                'id'    :   facebookPhoto.id,
                                                'added' :   facebookPhoto.created_time,
                                                'url'   :   makeFacebookPhotoURL( facebookPhoto.id, accessToken )
                                            });
                                        }
                                        deferreds[albumId].resolve();
                                    });
                            }

                            $.when.apply($, listOfDeferreds ).then( function() {
                                if (callback) {
                                    callback( allPhotos );
                                }
                            }, function( error ) {
                                if (callback) {
                                    callback( allPhotos, error );
                                }
                            });
                        });
                });
        }
    </script>

    <script>
        /**
         * This is the bootstrap / app script
         */

        // wait for DOM and facebook auth
        var docReady = $.Deferred();
        var facebookReady = $.Deferred();

        $(document).ready(docReady.resolve);

        window.fbAsyncInit = function() {
            FB.init({
              appId      : '581530521961724',
              channelUrl : '//conor.lavos.local/channel.html',
              status     : true,
              cookie     : true,
              xfbml      : true
            });
            facebookReady.resolve();
        };

        $.when(docReady, facebookReady).then(function() {
            if (typeof getPhotos !== 'undefined') {
                getPhotos( function( photos ) {
                    console.log( photos );
                });
            }
        });

        // call facebook script
        (function(d){
         var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
         js = d.createElement('script'); js.id = id; js.async = true;
         js.src = "http://connect.facebook.net/en_US/all.js";
         d.getElementsByTagName('head')[0].appendChild(js);
        }(document));

    </script>
</head>

<body>
    <div id="fb-root"></div>
    <section id="main">
    <h1 id="name"></h1>
    <img id="photo">
    <div id="accesstoken" style="display:none"></div>
    <div>
        <h2>This is a HTML5 Canvas Pages with Facebook</h2>
        <ul id="albums" onClick="getPhotos()">選取相簿照片</ul>
        選取相框<select id="frame">
          <option value="img/overlayback.png">First</option>
          <option value="img/overlay2.png">Second</option>
          <option value="img/background.png">Third</option>
          <option value="img/background1.png">forth</option>
          <option value="img/background2.png">fifth</option>
          <option value="img/background3.png">sixth</option>
        </select> 
        選取文字框<select id="word">
          <option value="img/backword.png">First</option>
          <option value="img/backword1.png">Second</option>
          <option value="img/backword2.png">Third</option>
          <option value="img/backword3.png">forth</option>
          <option value="img/backword4.png">fifth</option>
        </select> 
        <canvas width="540" height="540" id="canvas"></canvas>
    </div>
    </section>
    <div class="inputtext" style="width:600px; margin:0 auto;">
        <label for="inputed">輸入客製化文字：
            <textarea name="inputed" maxlength="6" id="inputed" placeholder="限輸6字"></textarea><!-- 提供使用者輸入文字欄-->
        </label>
        <br>
        <button id="sentimg" onClick="PostImageToFacebook()">Post to Facebook</button><!-- 傳送按鈕-->
    </div>
    <div class="info"></div><!-- 訊息欄位-->

    <!--

    <script type="text/javascript">
        var docReady = $.Deferred();
        var facebookReady = $.Deferred();

        $(document).ready(docReady.resolve);

    
    </script>
    <script type="text/javascript" src="js/script.js"></script>
-->
</body>

</html>


