<!doctype html>
<html prefix="og:http://ogp.me/ns#" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml" >
<html>

<head>
    <meta charset="utf-8">
    
    <meta property="og:title" content="Facebook API test" >
    <meta property="og:type" content="website" >
    <meta property="og:url" content="https://github.com/booda406/wp2014s_hw4" >
    <meta property="og:image" content="https://www.facebook.com/Bnlsteven/profile_picture" >

    <title>HTML5 Canvas & facebook</title>
    <meta name="description" content=" ">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="css/style.css">

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

	<style>
    #canvas {border: 3px solid grey;}
    </style>

    <script type="text/javascript" src="js/script.js"></script>

    <script>
        // wait for DOM and facebook auth
        var docReady = $.Deferred();
        var facebookReady = $.Deferred();

        $(document).ready(docReady.resolve);

window.fbAsyncInit = function () {//facebook init
    
//輸入基本的Facebook init的狀態，與Facebook 連接，包括APP ID的設定
  FB.init({
          appId      : '581530521961724',
          xfbml      : true,
          version    : 'v2.0'
        });
 facebookReady.resolve();

FB.getLoginStatus(function(response) {
  if (response.status === 'connected') {
      FB.login(function(response) {
      if (response.authResponse) {
        // user gave permission
      } else {
        // user did not give permission
      }
    }, {scope:'publish_actions,user_photos'});
    //呼叫api把圖片放到#preview IMG tag 內
    var uid = response.authResponse.userID;
    var accessToken = response.authResponse.accessToken;
    FB.api('/me/picture?type=large', function(response) { // normal/large/squere 
        $('#photo').attr("src", response.data.url);
    });
    FB.api('/me', function (response) {
        $('#name').html(response.name);
        // console.log(response.name);
    });
    $('#accesstoken').html(accessToken);
    // console.log(response);
    
  } else if (response.status === 'not_authorized') {
    //要求使用者登入，索取publish_actions權限
    FB.login(function(response) {
       // handle the response
       if (response.authResponse) { // if user login to your apps right after handle an event
            window.location.reload();
        };
     }, {
       scope: 'publish_actions,user_photos', 
       return_scopes: true
     });    
  } else {
    //同樣要求使用者登入
    FB.login(function(response) {
       // handle the response
       if (response.authResponse) { // if user login to your apps right after handle an event
            window.location.reload();
        };
     }, {
       scope: 'publish_actions,user_photos', 
       return_scopes: true
     });
   }
 });

}; //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<init end
 
        $.when(docReady, facebookReady).then(function() {
            if (typeof getPhotos !== 'undefined') {
                getPhotos( function( photos ) {
                    console.log( photos );
                });
            }
        });



//LOAD FACEBOOK SDK ASYNC，這是基本的東西，應該不用多說了吧
// (function(d, s, id) {
//   var js, fjs = d.getElementsByTagName(s)[0];
//   if (d.getElementById(id)) return;
//   js = d.createElement(s); js.id = id;
//   js.src = "//connect.facebook.net/zh_TW/sdk.js#xfbml=1&appId=581530521961724&version=v2.0";
//   fjs.parentNode.insertBefore(js, fjs);
// }(document, 'script', 'facebook-jssdk'));
// call facebook script
        (function(d){
         var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
         js = d.createElement('script'); js.id = id; js.async = true;
         js.src = "http://connect.facebook.net/en_US/all.js";
         d.getElementsByTagName('head')[0].appendChild(js);
        }(document));
    </script>
</head>

<body>
    <div id="fb-root"></div>
    <section id="main">
    <h1 id="name"></h1>
    <img id="photo">
    <div id="accesstoken" style="display:none"></div>
    <div>
        <h2>This is a HTML5 Canvas Pages with Facebook</h2>
        <ul id="albums" onClick="getPhotos()">選取相簿照片</ul>
        選取相框<select id="frame">
          <option value="img/overlayback.png">First</option>
          <option value="img/overlay2.png">Second</option>
          <option value="img/background.png">Third</option>
          <option value="img/background1.png">forth</option>
          <option value="img/background2.png">fifth</option>
          <option value="img/background3.png">sixth</option>
        </select> 
        選取文字框<select id="word">
          <option value="img/backword.png">First</option>
          <option value="img/backword1.png">Second</option>
          <option value="img/backword2.png">Third</option>
          <option value="img/backword3.png">forth</option>
          <option value="img/backword4.png">fifth</option>
        </select> 
        <canvas width="540" height="540" id="canvas"></canvas>
    </div>
    </section>
    <div class="inputtext" style="width:600px; margin:0 auto;">
        <label for="inputed">輸入客製化文字：
            <textarea name="inputed" maxlength="6" id="inputed" placeholder="限輸6字"></textarea><!-- 提供使用者輸入文字欄-->
        </label>
        <br>
        <button id="sentimg" onClick="PostImageToFacebook()">Post to Facebook</button><!-- 傳送按鈕-->
    </div>
    <div class="info"></div><!-- 訊息欄位-->


</body>

</html>


